// Configuração do Cliente Prisma
generator client {
  provider = "prisma-client-js"
}

// Configuração do Banco de Dados (Neon usa Postgres)
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Modelo de Usuário
model User {
  id                 String    @id @default(uuid())
  email              String    @unique
  name               String?
  
  // Autenticação
  passwordHash       String?   
  googleId           String?   @unique 
  
  // Rastreamento de Dispositivo
  fingerprint        String?   
  
  // Dados do Plano e Assinatura
  planType           String    @default("TRIAL") 
  subscriptionStatus String    @default("active") 
  
  // Integração Stripe (DEVEM ESTAR AQUI)
  stripeCustomerId       String?   @unique // ID do cliente no Stripe
  stripeSubscriptionId   String?   @unique // ID da assinatura vigente

  // Controle de Datas
  trialEndsAt        DateTime?
  nextBillingDate    DateTime? 
  
  // Limites de Uso
  messagesUsed       Int       @default(0)
  totalMessagesUsed  Int       @default(0)
  
  // Metadados
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  @@map("users")
}

// Histórico de Trials (Nunca é apagada)
model TrialLog {
  id           String   @id @default(uuid())
  emailHash    String   @unique
  fingerprint  String?
  usageHistory Int      @default(0) // Mantém o uso se a conta for recriada
  createdAt    DateTime @default(now())
  
  @@index([fingerprint])
  @@map("trial_logs")
}